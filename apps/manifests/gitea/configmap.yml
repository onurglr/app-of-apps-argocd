apiVersion: v1
kind: ConfigMap
metadata:
  name: gitea-config
  namespace: gitea
data:
  app.ini: |
    APP_NAME = Gitea: Git with a cup of tea
    RUN_MODE = prod

    [database]
    DB_TYPE = postgres
    HOST = postgresql.postgresql.svc.cluster.local:5432
    NAME = gitea
    USER = gitea
    PASSWD = gitea

    [server]
    DOMAIN = gitea.localtest.me
    SSH_DOMAIN = gitea.localtest.me
    HTTP_PORT = 3000
    ROOT_URL = http://gitea.localtest.me:30080/
    DISABLE_SSH = false
    SSH_PORT = 22

    [repository]
    ROOT = /data/git/repositories

    [session]
    PROVIDER = file

    [log]
    MODE = console
    LEVEL = Info

    [security]
    INSTALL_LOCK = true
  
  # Environment variables
  USER_UID: "1000"
  USER_GID: "1000"
  GITEA_CUSTOM: "/etc/gitea"
  
  # Init container script
  wait-for-postgres.sh: |
    #!/bin/sh
    until nc -z postgresql.postgresql.svc.cluster.local 5432; do
      echo "Waiting for PostgreSQL..."
      sleep 2
    done
    echo "PostgreSQL is ready!"

